# 整體效能影響

Method Swizzling 會對應用程式的效能產生影響，主要體現在以下幾個方面：

1. **派發機制較慢**：

   - Swift 預設使用「Table Dispatch」（表派發）或「Direct Dispatch」（直接派發），這些機制在編譯時期就能確定方法呼叫的位址，因此執行速度最快 [\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#6c945cf2-8c27-44d9-b07f-44af818f62a6,533cd99f-cf12-4d01-b641-4cbb116013d2,8f9cf6c0-a50f-43b2-a877-e6b1c7263651,a058faa2-abf8-472d-a378-edbc5c105f2d,1b226b28-a811-427a-80db-b591b78012f3,4c2ba7c6-b618-4b35-ba40-c4009799f3aa)。

   - Method Swizzling 依賴 Objective-C Runtime 的「Message Dispatch」（訊息派發）機制 [\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#6c945cf2-8c27-44d9-b07f-44af818f62a6,533cd99f-cf12-4d01-b641-4cbb116013d2,8f9cf6c0-a50f-43b2-a877-e6b1c7263651,a058faa2-abf8-472d-a378-edbc5c105f2d,1b226b28-a811-427a-80db-b591b78012f3,4c2ba7c6-b618-4b35-ba40-c4009799f3aa)。這種機制在執行時期動態查找方法實作，相較於 Swift 的預設派發方式，效率是最低的 [\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#6c945cf2-8c27-44d9-b07f-44af818f62a6,533cd99f-cf12-4d01-b641-4cbb116013d2,8f9cf6c0-a50f-43b2-a877-e6b1c7263651,a058faa2-abf8-472d-a378-edbc5c105f2d,1b226b28-a811-427a-80db-b591b78012f3,4c2ba7c6-b618-4b35-ba40-c4009799f3aa)。

   - 即使方法標記了 `@objc`，Swift 編譯器仍會預設使用 Table Dispatch 進行效能優化；只有同時加上 `dynamic` 關鍵字，才會強制使用 Objective-C Runtime 的訊息派發，進而支援 Swizzling [\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#6c945cf2-8c27-44d9-b07f-44af818f62a6,533cd99f-cf12-4d01-b641-4cbb116013d2,8f9cf6c0-a50f-43b2-a877-e6b1c7263651,a058faa2-abf8-472d-a378-edbc5c105f2d,1b226b28-a811-427a-80db-b591b78012f3,4c2ba7c6-b618-4b35-ba40-c4009799f3aa)。

2. **可能影響 App 啟動時間**：

   - Method Swizzling 通常在類別載入時的 `+load` 方法中執行，並使用 `dispatch_once` 確保只交換一次 [\[2\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#31f097b0-ac5c-4183-a9ac-556c5d10b2d3,245f0473-69c1-4ac2-a9aa-0e3f846f3f1a,1dea39a5-694e-4bbf-bea3-bd915b365190,e4a4eebb-32fb-45f9-bcbd-bd6d59c8654b,fb4cd427-0c07-492d-acc2-d110bfd5fe04,302c446d-3381-4d93-8777-ec6e8c2890e3,e011ba69-2494-41dd-8d83-19a9e5a34986,f1937570-6e6b-456c-9c87-b7652481bdb2,97424c5b-7a49-400d-a771-b25e5429b0c7,b5b203dc-4371-4cc6-85d8-0e064b07f910,ba1b00b7-26a9-471f-94c9-6ddaf6dc9569,536f6346-2a2e-42c6-ad38-61fb595b3b3b,4297927c-e087-4bd9-8a8b-8d578b7543a0,972f6b06-8c10-4d9a-b00a-9358a218cf87,2d157679-012e-493e-9f3a-345038add3ef)。如果進行大量的 Swizzling 操作，特別是在應用程式啟動初期，可能會增加 App 的啟動時間 [\[3\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#9f3eebf8-ffb8-4f43-b937-f8c8c349b4cd,968d5227-aa57-4628-a527-c38fc775228a,0dcc210b-a8a1-4660-981c-46a52d39d658,cf81b161-c1df-478b-a1e2-c1663045a338,d5dbeff1-e007-434b-a0ea-d6883489b1fd,edba0628-65ca-41b8-bff9-42bc904fca91,d05a786d-2ffb-449e-8fdf-8a44d969407b,be619749-be74-40b9-915b-e7f960a55e79,1f8ce962-5a9d-4bd0-ae7b-5cf630439964,609bb6ae-139c-4d5d-a2e2-6f5bdd701225,08228f78-3ca1-4ab8-aa1f-d54729aea8d4,81945215-17ad-4c00-a444-5d72be17833b,fdeaa4d8-182b-4805-b60a-28f2a94d7419)。

3. **整體執行效能**：

   - 由於每次透過 Swizzling 呼叫方法都需要經過 Objective-C Runtime 的訊息傳遞機制，這會引入額外的開銷，使得被 Swizzle 的方法執行效率略低於原始的 Swift 靜態或表派發方法 [\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#6c945cf2-8c27-44d9-b07f-44af818f62a6,533cd99f-cf12-4d01-b641-4cbb116013d2,8f9cf6c0-a50f-43b2-a877-e6b1c7263651,a058faa2-abf8-472d-a378-edbc5c105f2d,1b226b28-a811-427a-80db-b591b78012f3,4c2ba7c6-b618-4b35-ba40-c4009799f3aa)。

總結來說，Method Swizzling 雖然強大，但因為其底層依賴於較慢的 Objective-C Runtime 訊息派發機制，會對應用程式的啟動時間和執行效能造成一定程度的影響。因此，在現代 Swift 專案中，除非必要，通常會優先考慮更安全且高效的 Swift 原生替代方案 [\[4\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#565318e8-51d6-45cd-bd7c-3245f90881c0,73d01699-2ac9-4a17-a76b-726dc72e9cc8)[\[5\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#a5f2fe2b-4807-40b5-832f-595d4411f612,b811263e-49d8-4b5f-8251-3d6cfedb1181,9ec4085b-1938-4c66-9b14-1ce05606556f,387cee4b-42e2-4454-999c-5727a2270073,1cb45d84-bf64-4979-b6d4-42b9f1c2c662,fe47a977-3c0e-488f-8849-5312f8db1140,a5c38f25-d4e5-4aa5-9ffa-811807ff9fe6)[\[3\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#9f3eebf8-ffb8-4f43-b937-f8c8c349b4cd,968d5227-aa57-4628-a527-c38fc775228a,0dcc210b-a8a1-4660-981c-46a52d39d658,cf81b161-c1df-478b-a1e2-c1663045a338,d5dbeff1-e007-434b-a0ea-d6883489b1fd,edba0628-65ca-41b8-bff9-42bc904fca91,d05a786d-2ffb-449e-8fdf-8a44d969407b,be619749-be74-40b9-915b-e7f960a55e79,1f8ce962-5a9d-4bd0-ae7b-5cf630439964,609bb6ae-139c-4d5d-a2e2-6f5bdd701225,08228f78-3ca1-4ab8-aa1f-d54729aea8d4,81945215-17ad-4c00-a444-5d72be17833b,fdeaa4d8-182b-4805-b60a-28f2a94d7419)。
# 優缺點

Method Swizzling 是一種強大但同時也具有潛在風險的技術，其優缺點如下：

### 優點

- **無侵入式修改**：可以在不修改原始程式碼的情況下，變更系統框架（如 UIKit、Foundation）或第三方框架的行為。這在無法直接修改原始碼時特別有用。[\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#f270ddc0-33f0-4220-accf-aabbdf918db2,27459cca-9cbc-4833-aa00-c8ea42cc3921,63f92cbf-6f19-4925-8470-0354be785753,0a193702-6116-4c57-bb73-cebeed31e383,924db874-6547-469d-8554-8f717281e81f,3abac7e1-93d2-46c7-bbd4-fbbb9c925663,a5d32cf2-c3d1-424e-a0bd-91700e31e491,b2a4e4c8-f9ad-4467-b24b-b4d0bed03c0d,56c66f7a-e777-41f2-aeff-95ace8a0fc25,bf30f1f9-25b8-4676-8849-5a1bd0d870b4,c12c5f6b-d073-45ad-8ed9-39e24bc16152)

- **全域性方法攔截與監控**：能實現全應用程式範圍的方法攔截和監控，例如追蹤所有 `UIViewController` 的生命週期，而無需在每個類別中重複編寫程式碼。[\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#f270ddc0-33f0-4220-accf-aabbdf918db2,27459cca-9cbc-4833-aa00-c8ea42cc3921,63f92cbf-6f19-4925-8470-0354be785753,0a193702-6116-4c57-bb73-cebeed31e383,924db874-6547-469d-8554-8f717281e81f,3abac7e1-93d2-46c7-bbd4-fbbb9c925663,a5d32cf2-c3d1-424e-a0bd-91700e31e491,b2a4e4c8-f9ad-4467-b24b-b4d0bed03c0d,56c66f7a-e777-41f2-aeff-95ace8a0fc25,bf30f1f9-25b8-4676-8849-5a1bd0d870b4,c12c5f6b-d073-45ad-8ed9-39e24bc16152)

- **修復系統 Bug 或增加功能**：在某些特殊情況下，可以用來修復系統 Bug 或為既有類別添加功能，而無需透過繼承。[\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#f270ddc0-33f0-4220-accf-aabbdf918db2,27459cca-9cbc-4833-aa00-c8ea42cc3921,63f92cbf-6f19-4925-8470-0354be785753,0a193702-6116-4c57-bb73-cebeed31e383,924db874-6547-469d-8554-8f717281e81f,3abac7e1-93d2-46c7-bbd4-fbbb9c925663,a5d32cf2-c3d1-424e-a0bd-91700e31e491,b2a4e4c8-f9ad-4467-b24b-b4d0bed03c0d,56c66f7a-e777-41f2-aeff-95ace8a0fc25,bf30f1f9-25b8-4676-8849-5a1bd0d870b4,c12c5f6b-d073-45ad-8ed9-39e24bc16152)

- **支援 AOP（面向切面程式設計）**：非常適合實現[「橫切關注點」（Cross-cutting Concerns）.md](./「橫切關注點」（Cross-cutting%20Concerns）.md)，例如日誌記錄、效能監控、埋點統計等，將這些邏輯從核心業務邏輯中分離出來。[\[1\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#f270ddc0-33f0-4220-accf-aabbdf918db2,27459cca-9cbc-4833-aa00-c8ea42cc3921,63f92cbf-6f19-4925-8470-0354be785753,0a193702-6116-4c57-bb73-cebeed31e383,924db874-6547-469d-8554-8f717281e81f,3abac7e1-93d2-46c7-bbd4-fbbb9c925663,a5d32cf2-c3d1-424e-a0bd-91700e31e491,b2a4e4c8-f9ad-4467-b24b-b4d0bed03c0d,56c66f7a-e777-41f2-aeff-95ace8a0fc25,bf30f1f9-25b8-4676-8849-5a1bd0d870b4,c12c5f6b-d073-45ad-8ed9-39e24bc16152)

### 缺點

- **效能影響**：

   - **派發機制較慢**：Method Swizzling 依賴 Objective-C Runtime 的「訊息派發」機制，這種機制在執行時期動態查找方法實作，相較於 Swift 預設的「表派發」或「直接派發」，效率最低。[\[2\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/db459923-fe6b-4d7e-9426-ab6ef2c013c9#d7bdd630-1553-4d85-991c-03af5322891c,938b2121-5f85-40e5-ae2c-4b155d16b090,394777fd-02a3-4a66-90b9-935ab99a5718,fd09ada9-ff85-4b7b-84f8-080da3fafc26,cd9de4ed-6772-4b45-8ae5-eaf0d639f386,748b6945-bcc6-4027-bcc1-0443e55eb1e8)

   - **可能影響 App 啟動時間**：通常在類別載入時的 `+load` 方法中執行 Swizzling 操作。如果進行大量的 Swizzling，特別是在應用程式啟動初期，可能會增加 App 的啟動時間。[\[2\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/db459923-fe6b-4d7e-9426-ab6ef2c013c9#d7bdd630-1553-4d85-991c-03af5322891c,938b2121-5f85-40e5-ae2c-4b155d16b090,394777fd-02a3-4a66-90b9-935ab99a5718,fd09ada9-ff85-4b7b-84f8-080da3fafc26,cd9de4ed-6772-4b45-8ae5-eaf0d639f386,748b6945-bcc6-4027-bcc1-0443e55eb1e8)

   - **整體執行開銷**：每次透過 Swizzling 呼叫方法，都需要經過 Objective-C Runtime 的訊息傳遞機制，這會引入額外的開銷，導致被 Swizzle 的方法執行效率略低於原始的 Swift 方法。[\[2\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/db459923-fe6b-4d7e-9426-ab6ef2c013c9#d7bdd630-1553-4d85-991c-03af5322891c,938b2121-5f85-40e5-ae2c-4b155d16b090,394777fd-02a3-4a66-90b9-935ab99a5718,fd09ada9-ff85-4b7b-84f8-080da3fafc26,cd9de4ed-6772-4b45-8ae5-eaf0d639f386,748b6945-bcc6-4027-bcc1-0443e55eb1e8)

- **複雜性與風險**：

   - **強大但危險**：Method Swizzling 是一種強大但具有高度風險的技術。[\[3\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#d2d32b30-5de1-48fb-ab82-a67884409fe0,ff16a135-bd50-4500-b1db-601dbf667169,9dbad8ce-8b98-4161-8f30-6206174052d8)

   - **程式碼難以維護**：濫用 Swizzling 會導致程式碼難以理解和維護。[\[4\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#9f3eebf8-ffb8-4f43-b937-f8c8c349b4cd,968d5227-aa57-4628-a527-c38fc775228a,0dcc210b-a8a1-4660-981c-46a52d39d658,cf81b161-c1df-478b-a1e2-c1663045a338,d5dbeff1-e007-434b-a0ea-d6883489b1fd,edba0628-65ca-41b8-bff9-42bc904fca91,d05a786d-2ffb-449e-8fdf-8a44d969407b,be619749-be74-40b9-915b-e7f960a55e79,1f8ce962-5a9d-4bd0-ae7b-5cf630439964,609bb6ae-139c-4d5d-a2e2-6f5bdd701225,08228f78-3ca1-4ab8-aa1f-d54729aea8d4,81945215-17ad-4c00-a444-5d72be17833b,fdeaa4d8-182b-4805-b60a-28f2a94d7419)

   - **除錯困難**：當程式碼出現問題時，由於方法的實際執行與其名稱不符，堆疊追蹤（Stack Trace）會變得難以理解，增加除錯的難度。[\[4\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#9f3eebf8-ffb8-4f43-b937-f8c8c349b4cd,968d5227-aa57-4628-a527-c38fc775228a,0dcc210b-a8a1-4660-981c-46a52d39d658,cf81b161-c1df-478b-a1e2-c1663045a338,d5dbeff1-e007-434b-a0ea-d6883489b1fd,edba0628-65ca-41b8-bff9-42bc904fca91,d05a786d-2ffb-449e-8fdf-8a44d969407b,be619749-be74-40b9-915b-e7f960a55e79,1f8ce962-5a9d-4bd0-ae7b-5cf630439964,609bb6ae-139c-4d5d-a2e2-6f5bdd701225,08228f78-3ca1-4ab8-aa1f-d54729aea8d4,81945215-17ad-4c00-a444-5d72be17833b,fdeaa4d8-182b-4805-b60a-28f2a94d7419)

   - **潛在的 Bug**：可能引發意想不到的 Bug，例如重複交換導致方法恢復原狀，或與其他使用 Swizzling 的程式碼（如第三方 SDK）產生衝突。[\[4\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#9f3eebf8-ffb8-4f43-b937-f8c8c349b4cd,968d5227-aa57-4628-a527-c38fc775228a,0dcc210b-a8a1-4660-981c-46a52d39d658,cf81b161-c1df-478b-a1e2-c1663045a338,d5dbeff1-e007-434b-a0ea-d6883489b1fd,edba0628-65ca-41b8-bff9-42bc904fca91,d05a786d-2ffb-449e-8fdf-8a44d969407b,be619749-be74-40b9-915b-e7f960a55e79,1f8ce962-5a9d-4bd0-ae7b-5cf630439964,609bb6ae-139c-4d5d-a2e2-6f5bdd701225,08228f78-3ca1-4ab8-aa1f-d54729aea8d4,81945215-17ad-4c00-a444-5d72be17833b,fdeaa4d8-182b-4805-b60a-28f2a94d7419)

   - **版本相容性問題**：iOS 系統更新後，系統類別的方法簽名可能改變，導致 Swizzling 的程式碼不再穩定或直接崩潰。[\[4\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/f4179383-d06d-417f-8a55-67ae55c8c2d9#9f3eebf8-ffb8-4f43-b937-f8c8c349b4cd,968d5227-aa57-4628-a527-c38fc775228a,0dcc210b-a8a1-4660-981c-46a52d39d658,cf81b161-c1df-478b-a1e2-c1663045a338,d5dbeff1-e007-434b-a0ea-d6883489b1fd,edba0628-65ca-41b8-bff9-42bc904fca91,d05a786d-2ffb-449e-8fdf-8a44d969407b,be619749-be74-40b9-915b-e7f960a55e79,1f8ce962-5a9d-4bd0-ae7b-5cf630439964,609bb6ae-139c-4d5d-a2e2-6f5bdd701225,08228f78-3ca1-4ab8-aa1f-d54729aea8d4,81945215-17ad-4c00-a444-5d72be17833b,fdeaa4d8-182b-4805-b60a-28f2a94d7419)

總結來說，Method Swizzling 雖然在特定場景下能解決「不可能」的問題，但在現代 Swift 專案中，除非有不得已的理由，通常會優先考慮更安全且高效的 Swift 原生替代方案，例如 Protocol + Extension、Decorator Pattern 或 Swift 的新特性（如 Property Wrappers）。[\[2\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/db459923-fe6b-4d7e-9426-ab6ef2c013c9#d7bdd630-1553-4d85-991c-03af5322891c,938b2121-5f85-40e5-ae2c-4b155d16b090,394777fd-02a3-4a66-90b9-935ab99a5718,fd09ada9-ff85-4b7b-84f8-080da3fafc26,cd9de4ed-6772-4b45-8ae5-eaf0d639f386,748b6945-bcc6-4027-bcc1-0443e55eb1e8)[\[5\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#3151f566-38d5-4ddc-8d78-3e00031c6134,b73ded11-0aca-4992-906d-b91f95cb12c9,956c15be-3f97-4735-ba36-717dd9cdce0a,19feef51-079e-4a8a-afb7-074bff41a4e0,d5078720-04ed-49b0-98a1-14b03656626c,30894b29-d359-4fa0-9112-7614d63ea2dd)[\[6\]](https://app.heptabase.com/f3c4fc0d-fe07-4b10-932c-6f968c1f5ab0/card/3ef0d3e1-3d6c-4f9d-92fc-462b910da089#a5f2fe2b-4807-40b5-832f-595d4411f612,b811263e-49d8-4b5f-8251-3d6cfedb1181,9ec4085b-1938-4c66-9b14-1ce05606556f,387cee4b-42e2-4454-999c-5727a2270073,1cb45d84-bf64-4979-b6d4-42b9f1c2c662,fe47a977-3c0e-488f-8849-5312f8db1140,a5c38f25-d4e5-4aa5-9ffa-811807ff9fe6)